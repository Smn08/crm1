## Основные сущности и их атрибуты (обновлено)

### 1. Пользователь (User)
- `id`: Уникальный идентификатор
- `username`: Имя пользователя (уникальное)
- `email`: Email пользователя (уникальное)
- `password_hash`: Хеш пароля
- `role`: Роль пользователя (customer, agent, admin)
- `created_at`: Дата создания
- `updated_at`: Дата последнего обновления

### 2. Заявка (Ticket)
- `id`: Уникальный идентификатор
- `title`: Заголовок заявки
- `description`: Подробное описание проблемы
- `customer_id`: ID заказчика (ссылка на User)
- `agent_id`: ID назначенного исполнителя (ссылка на User, может быть null)
- `status_id`: ID текущего статуса (ссылка на Status)
- `priority`: Приоритет (Low, Medium, High, Critical)
- `created_at`: Дата создания
- `updated_at`: Дата последнего обновления
- `closed_at`: Дата закрытия (может быть null)

### 3. Сообщение (Message)
- `id`: Уникальный идентификатор
- `ticket_id`: ID заявки (ссылка на Ticket)
- `sender_id`: ID отправителя (ссылка на User)
- `content`: Текст сообщения
- `created_at`: Дата создания

### 4. Статус (Status)
- `id`: Уникальный идентификатор
- `name`: Название статуса (Open, In Progress, Awaiting Customer Reply, Awaiting Agent Reply, Resolved, Closed)
- `description`: Описание статуса

### 5. Статья Базы Знаний (KnowledgeBaseArticle)
- `id`: Уникальный идентификатор
- `title`: Заголовок статьи
- `content`: Содержание статьи (Markdown)
- `category`: Категория статьи (например, FAQ, Инструкции, Устранение неполадок)
- `author_id`: ID автора (ссылка на User)
- `created_at`: Дата создания
- `updated_at`: Дата последнего обновления

## Схема базы данных (обновлено)

Используем SQLite для простоты разработки. Схема будет включать таблицы для `users`, `tickets`, `messages`, `statuses` и `knowledge_base_articles`.

## Логика статусов (обновлено)

- **Open**: Новая заявка, созданная заказчиком. Ожидает назначения исполнителя.
- **In Progress**: Заявка назначена исполнителю. Исполнитель активно работает над ней.
- **Awaiting Customer Reply**: Исполнитель ответил на заявку и ожидает дополнительной информации или подтверждения от заказчика.
- **Awaiting Agent Reply**: Заказчик ответил на заявку, и теперь исполнитель должен отреагировать.
- **Resolved**: Исполнитель считает проблему решенной и ожидает подтверждения от заказчика.
- **Closed**: Заявка полностью закрыта. Это может быть сделано заказчиком после подтверждения решения или администратором/исполнителем.

**Автоматические переходы статусов:**
- При создании заявки: `Open`
- При назначении исполнителя: `Open` -> `In Progress`
- При отправке сообщения исполнителем: `In Progress` -> `Awaiting Customer Reply`
- При отправке сообщения заказчиком: `Awaiting Customer Reply` -> `Awaiting Agent Reply`
- При решении заявки исполнителем: `In Progress` / `Awaiting Agent Reply` -> `Resolved`
- При закрытии заявки заказчиком/администратором: `Resolved` -> `Closed`

## API-эндпоинты (обновлено)

### Аутентификация
- `POST /api/login` - Вход в систему (только вход, без регистрации)
- `POST /api/logout` - Выход из системы
- `GET /api/me` - Получение информации о текущем пользователе

### Пользователи (только для администраторов)
- `GET /api/users` - Получение списка всех пользователей
- `POST /api/users` - Создание нового пользователя (администратором)
- `PUT /api/users/{id}` - Обновление информации о пользователе (администратором)
- `DELETE /api/users/{id}` - Удаление пользователя (администратором)

### Заявки
- `GET /api/tickets` - Получение списка заявок (с фильтрацией по роли и статусу)
- `POST /api/tickets` - Создание новой заявки (для заказчиков)
- `GET /api/tickets/{id}` - Получение деталей заявки
- `PUT /api/tickets/{id}/status` - Изменение статуса заявки (для исполнителей и администраторов)
- `PUT /api/tickets/{id}/assign` - Назначение исполнителя на заявку (для администраторов)

### Сообщения
- `GET /api/tickets/{id}/messages` - Получение сообщений по заявке
- `POST /api/tickets/{id}/messages` - Отправка нового сообщения в заявку

### Статусы
- `GET /api/statuses` - Получение списка всех доступных статусов

### База Знаний
- `GET /api/knowledgebase` - Получение списка всех статей
- `GET /api/knowledgebase/{id}` - Получение статьи по ID
- `POST /api/knowledgebase` - Создание новой статьи (для администраторов)
- `PUT /api/knowledgebase/{id}` - Обновление статьи (для администраторов)
- `DELETE /api/knowledgebase/{id}` - Удаление статьи (для администраторов)

## Визуальная составляющая (обновлено)

- **Общий дизайн**: Чистый, современный, адаптивный дизайн с использованием Tailwind CSS и shadcn/ui.
- **Цветовая палитра**: Гармоничные цвета, возможно, с поддержкой темной/светлой темы.
- **Навигация**: Интуитивно понятная навигация для каждой роли.
- **Страницы**: 
    - **Страница входа**: Простая и понятная форма.
    - **Панель управления (Dashboard)**: Обзор заявок, статистики (для админов/исполнителей).
    - **Список заявок**: Таблица с фильтрацией, сортировкой и поиском.
    - **Детали заявки**: Подробная информация о заявке, история переписки, возможность отправки сообщений, изменения статуса и назначения исполнителя.
    - **Управление пользователями (только для админов)**: Таблица пользователей с возможностью создания, редактирования и удаления.
    - **База знаний**: Список статей, просмотр статей, формы для создания/редактирования статей.
- **Уведомления**: Визуальные индикаторы новых сообщений или изменений статуса.
- **Адаптивность**: Корректное отображение на различных устройствах (десктоп, планшет, мобильный).

## Обновленный план действий

### Phase 1: Пересмотр требований и проектирование архитектуры
- [x] Обновить документацию по сущностям, схеме БД, логике статусов и API эндпоинтам.
- [x] Убрать регистрацию из frontend.
- [x] Добавить функционал управления пользователями для администраторов.
- [x] Добавить модель и API для базы знаний.

### Phase 2: Исправление CORS и доработка Backend API
- [ ] Исправить проблему с CORS, чтобы frontend мог взаимодействовать с backend.
- [ ] Реализовать API для управления пользователями (CRUD).
- [ ] Реализовать API для базы знаний (CRUD).
- [ ] Обновить логику аутентификации, чтобы убрать регистрацию.
- [ ] Доработать логику изменения статусов и назначения исполнителей.

### Phase 3: Доработка Frontend интерфейса и реализация базы знаний
- [ ] Удалить страницу регистрации.
- [ ] Создать страницу управления пользователями для администраторов.
- [ ] Создать страницы для базы знаний (список, просмотр, создание/редактирование).
- [ ] Интегрировать новый функционал с backend API.
- [ ] Улучшить UI/UX существующих компонентов.

### Phase 4: Комплексное тестирование и отладка
- [ ] Провести полное тестирование всех новых и измененных функций.
- [ ] Отладить выявленные ошибки.
- [ ] Проверить корректность работы всех ролей.

### Phase 5: Финальная демонстрация и подготовка к развертыванию
- [ ] Подготовить демонстрацию приложения с учетом всех новых функций.
- [ ] Подготовить финальную документацию.
- [ ] Развернуть приложение.

