# Демонстрация API системы поддержки

## Созданные тестовые пользователи

### 1. Администратор
- **ID**: 1
- **Логин**: admin
- **Email**: admin@support.com
- **Роль**: admin

### 2. Заказчик
- **ID**: 2
- **Логин**: customer1
- **Email**: customer1@example.com
- **Роль**: customer

### 3. Исполнитель
- **ID**: 3
- **Логин**: agent1
- **Email**: agent1@support.com
- **Роль**: agent

## Созданные заявки

### Заявка #1
- **Заголовок**: "Проблема с входом в систему"
- **Описание**: "Не могу войти в личный кабинет, выдает ошибку авторизации"
- **Приоритет**: High
- **Статус**: Open
- **Заказчик**: customer1

## Примеры API запросов

### 1. Получение всех заявок (как администратор)
```bash
# Вход как админ
curl -X POST http://localhost:5002/api/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}' \
  -c admin_cookies.txt

# Получение заявок
curl -X GET http://localhost:5002/api/tickets \
  -b admin_cookies.txt
```

### 2. Назначение исполнителя на заявку
```bash
# Назначить agent1 на заявку #1
curl -X PUT http://localhost:5002/api/tickets/1/assign \
  -H "Content-Type: application/json" \
  -b admin_cookies.txt \
  -d '{"agent_id": 3}'
```

### 3. Изменение статуса заявки
```bash
# Изменить статус на "В работе"
curl -X PUT http://localhost:5002/api/tickets/1/status \
  -H "Content-Type: application/json" \
  -b admin_cookies.txt \
  -d '{"status": "In Progress"}'
```

### 4. Отправка сообщения в заявку
```bash
# Вход как исполнитель
curl -X POST http://localhost:5002/api/login \
  -H "Content-Type: application/json" \
  -d '{"username":"agent1","password":"password123"}' \
  -c agent_cookies.txt

# Отправка сообщения
curl -X POST http://localhost:5002/api/tickets/1/messages \
  -H "Content-Type: application/json" \
  -b agent_cookies.txt \
  -d '{"content": "Здравствуйте! Я принял вашу заявку в работу. Для решения проблемы мне нужна дополнительная информация: какой браузер вы используете и какую именно ошибку видите?"}'
```

### 5. Получение сообщений заявки
```bash
curl -X GET http://localhost:5002/api/tickets/1/messages \
  -b agent_cookies.txt
```

## Workflow демонстрации

1. **Создание заявки заказчиком** ✅
   - Заказчик создает заявку с описанием проблемы
   - Статус: "Open"

2. **Назначение исполнителя администратором**
   - Администратор назначает исполнителя на заявку
   - Статус: "In Progress"

3. **Ответ исполнителя**
   - Исполнитель отвечает на заявку
   - Статус автоматически меняется на "Awaiting Customer Reply"

4. **Ответ заказчика**
   - Заказчик отвечает на вопросы исполнителя
   - Статус автоматически меняется на "Awaiting Agent Reply"

5. **Решение проблемы**
   - Исполнитель предоставляет решение
   - Статус меняется на "Resolved"

6. **Закрытие заявки**
   - Заказчик подтверждает решение или администратор закрывает заявку
   - Статус: "Closed"

## Проверка функциональности

### ✅ Работающие функции:
- Регистрация и аутентификация пользователей
- Создание и просмотр заявок
- Назначение исполнителей
- Изменение статусов
- Система сообщений
- Фильтрация заявок по ролям
- CORS настройки для API

### ⚠️ Известные ограничения:
- Frontend не может подключиться к backend через браузер (проблема с сетевыми настройками)
- API полностью функционален при прямом обращении

## Следующие шаги для продакшена:
1. Исправить проблемы с CORS/сетевым подключением
2. Добавить HTTPS
3. Настроить production базу данных (PostgreSQL)
4. Добавить логирование и мониторинг
5. Настроить CI/CD pipeline
6. Добавить тесты

